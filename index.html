<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLM Business Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        :root {
            --primary: #f0b90b;
            --secondary: #1a1a1a;
            --success: #00a86b;
            --sidebar: #2c3e50;
            --card-bg: #ffffff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f8f9fa;
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--sidebar);
            color: white;
            padding: 20px 0;
        }
        
        .logo {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid #34495e;
            margin-bottom: 20px;
        }
        
        .logo h2 {
            color: var(--primary);
            font-size: 24px;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover, .nav-item.active {
            background: #34495e;
            border-left: 4px solid var(--primary);
        }
        
        .nav-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 4px solid var(--primary);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--secondary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        /* Investment Section */
        .investment-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .investment-amount {
            font-size: 36px;
            font-weight: bold;
            color: var(--success);
            text-align: center;
            margin: 20px 0;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: black;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-block {
            width: 100%;
            padding: 15px;
        }
        
        /* Wallet Cards */
        .wallet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .wallet-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .wallet-amount {
            font-size: 28px;
            font-weight: bold;
            color: var(--success);
            margin: 15px 0;
        }
        
        /* Contract Status */
        .contract-status {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 25px;
        }
        
        .status-item {
            display: flex;
            justify-content: between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .status-label {
            color: #666;
        }
        
        .status-value {
            font-weight: bold;
            color: var(--secondary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <h2>üöÄ MLM PRO</h2>
        </div>
        <ul class="nav-menu">
            <li class="nav-item active" onclick="showTab('dashboard')">
                üìä Dashboard
            </li>
            <li class="nav-item" onclick="showTab('profile')">
                üë§ Profile
            </li>
            <li class="nav-item" onclick="showTab('genealogy')">
                üå≥ Genealogy
            </li>
            <li class="nav-item" onclick="showTab('invest')">
                üí∞ Invest Now
            </li>
            <li class="nav-item" onclick="showTab('earning-report')">
                üìà Earning Report
            </li>
            <li class="nav-item" onclick="showTab('income-wallet')">
                üí≥ Income Wallet
            </li>
            <li class="nav-item" onclick="showTab('swap-wallet')">
                üîÑ Swap Wallet
            </li>
            <li class="nav-item" onclick="showTab('e-wallet')">
                üè¶ E-Wallet
            </li>
            <li class="nav-item" onclick="showTab('support')">
                üé´ Support
            </li>
            <li class="nav-item" onclick="logout()">
                üö™ Logout
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="user-info">
                <div class="user-avatar">TEAM008</div>
                <div>
                    <h3>Welcome, Team Leader!</h3>
                    <p>User ID: TEAM008 | Rank: Silver</p>
                </div>
            </div>
            <div>
                <button class="btn btn-primary" onclick="connectWallet()">üîó Connect Wallet</button>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalTeam">3</div>
                    <div class="stat-label">Total Team</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeTeam">3</div>
                    <div class="stat-label">Active Team</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="todayJoining">0</div>
                    <div class="stat-label">Today's Joining</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="directReferral">1</div>
                    <div class="stat-label">Direct Referral</div>
                </div>
            </div>

            <!-- Investment Section -->
            <div class="investment-section">
                <h3>Total Investment</h3>
                <div class="investment-amount" id="totalInvestment">1,000.00 USDT</div>
                <div style="text-align: center;">
                    <button class="btn btn-success" onclick="claimAirdrop()">üéÅ Claim Airdrop</button>
                </div>
            </div>

            <!-- Wallet Grid -->
            <div class="wallet-grid">
                <div class="wallet-card">
                    <h3>üí∞ Income Wallet</h3>
                    <div class="wallet-amount" id="incomeWallet">250.00 USDT</div>
                    <button class="btn btn-primary btn-block" onclick="withdrawIncome()">Withdraw</button>
                </div>
                
                <div class="wallet-card">
                    <h3>üîÑ Swap Wallet</h3>
                    <div class="wallet-amount" id="swapWallet">150.00 USDT</div>
                    <button class="btn btn-primary btn-block" onclick="swapTokens()">Swap Now</button>
                </div>
                
                <div class="wallet-card">
                    <h3>üè¶ E-Wallet</h3>
                    <div class="wallet-amount" id="eWallet">600.00 USDT</div>
                    <button class="btn btn-primary btn-block" onclick="transferEWallet()">Transfer</button>
                </div>
            </div>

            <!-- Contract Status -->
            <div class="contract-status">
                <h3>üìä Contract Status</h3>
                <div class="status-item">
                    <span class="status-label">Contract Address:</span>
                    <span class="status-value" id="contractAddress">0x019B57719039959E91cf4f6BFE424081CFD410d0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Network:</span>
                    <span class="status-value" id="networkStatus">BSC Testnet</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Wallet Connected:</span>
                    <span class="status-value" id="walletStatus">Not Connected</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Registration Status:</span>
                    <span class="status-value" id="regStatus">Not Registered</span>
                </div>
            </div>
        </div>

        <!-- Other Tabs (Placeholder) -->
        <div id="profile" class="tab-content">
            <h2>üë§ User Profile</h2>
            <p>Profile management coming soon...</p>
        </div>
        
        <div id="genealogy" class="tab-content">
            <h2>üå≥ Team Genealogy</h2>
            <p>Team structure visualization coming soon...</p>
        </div>
        
        <div id="invest" class="tab-content">
            <h2>üí∞ Investment Plans</h2>
            <p>Investment options coming soon...</p>
        </div>
        
        <div id="earning-report" class="tab-content">
            <h2>üìà Earning Reports</h2>
            <p>Detailed earnings report coming soon...</p>
        </div>

        <!-- Add other tabs similarly -->
    </div>

    <script>
        // Contract Configuration
        const CONTRACT_ADDRESS = "0x019B57719039959E91cf4f6BFE424081CFD410d0";
        const CONTRACT_ABI = [
            "function register(address upline) external payable",
            "function getUser(address user) external view returns (uint256, uint256, bool)",
            "function getEarnings(address user) external view returns (uint256)",
            "function directReferrals(address user) external view returns (uint256)",
            "function totalTeam(address user) external view returns (uint256)",
            "function withdraw() external",
            "function invest(uint256 amount) external"
        ];

        let provider, signer, userAddress, contract;

        // Tab Navigation
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Activate selected nav item
            event.target.classList.add('active');
        }

        // Connect Wallet
        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    alert('Please install MetaMask!');
                    return;
                }

                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = accounts[0];
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                // Update UI
                document.getElementById('walletStatus').textContent = "Connected ‚úÖ";
                document.getElementById('walletStatus').style.color = "#00a86b";
                
                // Load contract data
                await loadContractData();

            } catch (error) {
                console.error("Wallet connection failed:", error);
                alert("Connection failed: " + error.message);
            }
        }

        // Load data from contract
        async function loadContractData() {
            try {
                if (!contract) return;

                // Get user data from contract
                const userData = await contract.getUser(userAddress);
                const directRefs = await contract.directReferrals(userAddress);
                const totalTeamCount = await contract.totalTeam(userAddress);
                const earnings = await contract.getEarnings(userAddress);

                // Update dashboard
                document.getElementById('directReferral').textContent = directRefs.toString();
                document.getElementById('totalTeam').textContent = totalTeamCount.toString();
                document.getElementById('activeTeam').textContent = totalTeamCount.toString(); // Assuming all are active
                document.getElementById('regStatus').textContent = userData[2] ? "Registered ‚úÖ" : "Not Registered";

                // Convert earnings to USDT (assuming 6 decimals)
                const earningsUSDT = ethers.utils.formatUnits(earnings, 6);
                document.getElementById('incomeWallet').textContent = parseFloat(earningsUSDT).toFixed(2) + " USDT";

            } catch (error) {
                console.error("Error loading contract data:", error);
            }
        }

        // Claim Airdrop
        async function claimAirdrop() {
            try {
                if (!contract) {
                    alert("Please connect wallet first!");
                    return;
                }

                // This would call your contract's airdrop function
                alert("Airdrop claim function would be called here");
                // const tx = await contract.claimAirdrop();
                // await tx.wait();
                
            } catch (error) {
                alert("Airdrop claim failed: " + error.message);
            }
        }

        // Withdraw Income
        async function withdrawIncome() {
            try {
                if (!contract) {
                    alert("Please connect wallet first!");
                    return;
                }

                const tx = await contract.withdraw({
                    gasLimit: 200000
                });
                
                alert("Withdrawal transaction submitted!");
                await tx.wait();
                alert("Withdrawal successful!");
                
                // Reload data
                await loadContractData();
                
            } catch (error) {
                alert("Withdrawal failed: " + error.message);
            }
        }

        // Swap Tokens
        async function swapTokens() {
            alert("Token swap functionality would be implemented here");
        }

        // Transfer E-Wallet
        async function transferEWallet() {
            alert("E-Wallet transfer functionality would be implemented here");
        }

        // Logout
        function logout() {
            if (confirm("Are you sure you want to logout?")) {
                window.location.reload();
            }
        }

        // Auto-connect if wallet was previously connected
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined') {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length > 0) {
                    setTimeout(connectWallet, 1000);
                }
            }
        });
    </script>
</body>
</html>
